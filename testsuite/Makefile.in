#
# Copyright (c) 2004-2014 Jean-Luc Thiffeault <jeanluc@mailaps.org>
#
# See the file LICENSE for copying permission.
#

srcdir = @srcdir@

RODENTDIR = ..
JLTDIR = ../extern/jlt

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@ @CXX_OPTIMIZE_FLAGS@ -I$(srcdir)/$(RODENTDIR) -I$(JLTDIR)

LIBS = -lm

############################################################################

TESTSUITE = simpharmonic cexp adaptiverk4 cadaptiverk4 valadaptiverk4 arkCashKarp stiff order adamsbashforth blitz_adaptiverk4 ADrwave

.SUFFIXES: .o .cpp

.cpp.o:
	$(CXX) $(CXXFLAGS) -c $(srcdir)/$*.cpp

$(TESTSUITE):
	$(CXX) $(LDFLAGS) $@.o -o $@ $(LIBS)

###########################################################################

all:		$(TESTSUITE)

tests:		$(TESTSUITE)

testsuite:	$(TESTSUITE)

simpharmonic:		simpharmonic.o
cexp:			cexp.o
adaptiverk4:		adaptiverk4.o
cadaptiverk4:		cadaptiverk4.o
valadaptiverk4:		valadaptiverk4.o
arkCashKarp:		arkCashKarp.o
stiff:			stiff.o
order:			order.o
adamsbashforth:		adamsbashforth.o
blitz_adaptiverk4:	blitz_adaptiverk4.o
ADrwave:		ADrwave.o

inline_test:
	@rm -f inline_test.o
	@echo
	@echo 'Compile without inlining:'
	@echo
	$(CXX) -Wall -c -I$(srcdir)/$(RODENTDIR) -I$(JLTDIR) inline_test.cpp
	@echo 'The function is called, as seen in the disassembly:'
	objdump -Cd inline_test.o | grep Harmonic\<double\>::operator\(\)
	@echo
	@echo 'Compile with inlining (-O):'
	@echo
	$(CXX) -Wall -c -O -I$(srcdir)/$(RODENTDIR) -I$(JLTDIR) inline_test.cpp
	-objdump -Cd inline_test.o | grep Harmonic\<double\>::operator\(\)
	@echo 'The function does not appear in the disassembly.'

###########################################################################

clean:
	rm -f *.o $(TESTSUITE)
